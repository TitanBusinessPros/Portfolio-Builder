<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Builder - Complete</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Montserrat:wght@400;500;600&family=Open+Sans:wght@400;500;600&family=Roboto:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #ecf0f1;
            --accent: #3498db;
            --text: #333;
            --light-text: #777;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 2rem;
            --spacing-xl: 4rem;
            --border-radius: 8px;
            --transition: all 0.3s ease;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            --header-bg: #2c3e50; /* Added variable for header background */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            color: var(--text);
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            line-height: 1.6;
            min-height: 100vh;
            padding: var(--spacing-md);
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .app-header {
            text-align: center;
            padding: var(--spacing-lg);
            background: var(--header-bg); /* Using variable instead of hardcoded color */
            color: white;
        }

        .app-header h1 {
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }

        .app-header p {
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .app-main {
            display: flex;
            min-height: 600px;
        }

        .components-sidebar {
            width: 250px;
            background: var(--secondary);
            padding: var(--spacing-md);
            border-right: 1px solid #ddd;
        }

        .components-sidebar h2 {
            margin-bottom: var(--spacing-md);
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .component-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .component-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
            border-color: var(--accent);
        }

        .component-item i {
            font-size: 1.5rem;
            color: var(--accent);
            margin-bottom: var(--spacing-sm);
            display: block;
        }

        .builder-area {
            flex: 1;
            padding: var(--spacing-md);
            background: #f9f9f9;
            display: flex;
            flex-direction: column;
        }

        .builder-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid #eee;
        }

        .builder-controls {
            display: flex;
            gap: var(--spacing-sm);
        }

        .control-btn {
            padding: 0.6rem 1rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            transition: var(--transition);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #1a252f;
        }

        .btn-secondary {
            background: var(--secondary);
            color: var(--text);
        }

        .btn-secondary:hover {
            background: #dde4e6;
        }

        .components-container {
            flex: 1;
            padding: var(--spacing-md);
            background: white;
            border-radius: var(--border-radius);
            border: 2px dashed #ddd;
            min-height: 400px;
            transition: var(--transition);
        }

        .components-container.empty {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f6f8fa;
        }

        .empty-builder-message {
            text-align: center;
            color: #aaa;
            padding: var(--spacing-lg);
        }

        .empty-builder-message i {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
            display: block;
        }

        .portfolio-component {
            background: white;
            border: 1px solid #eee;
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            position: relative;
            transition: var(--transition);
            animation: fadeIn 0.5s ease;
        }

        .portfolio-component:hover {
            box-shadow: var(--shadow);
        }

        .component-controls {
            position: absolute;
            top: -15px;
            right: 10px;
            display: flex;
            gap: 0.5rem;
            z-index: 10;
        }

        .control-btn-sm {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            transition: var(--transition);
        }

        .control-btn-sm:hover {
            transform: scale(1.1);
        }

        .hero-component {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: var(--spacing-xl);
            text-align: center;
            border-radius: var(--border-radius);
        }

        .hero-component h2 {
            font-size: 2.5rem;
            margin-bottom: var(--spacing-md);
            color: var(--primary);
        }

        .hero-component p {
            font-size: 1.2rem;
            color: var(--light-text);
            margin-bottom: var(--spacing-lg);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .gallery-component h3 {
            margin-bottom: var(--spacing-md);
            color: var(--primary);
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-md);
        }

        .gallery-item {
            position: relative;
            border-radius: var(--border-radius);
            overflow: hidden;
            height: 150px;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .gallery-item:hover img {
            transform: scale(1.05);
        }

        .about-component h3 {
            margin-bottom: var(--spacing-md);
            color: var(--primary);
            text-align: center;
        }

        .about-component p {
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
        }

        .contact-component h3 {
            margin-bottom: var(--spacing-md);
            color: var(--primary);
            text-align: center;
        }

        .contact-details {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            align-items: center;
        }

        .contact-detail {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .contact-detail i {
            color: var(--accent);
            width: 20px;
        }

        .customization-panel {
            width: 250px;
            background: var(--secondary);
            padding: var(--spacing-md);
            border-left: 1px solid #ddd;
        }

        .customization-panel h2 {
            margin-bottom: var(--spacing-md);
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .panel-section {
            margin-bottom: var(--spacing-lg);
        }

        .panel-section h3 {
            margin-bottom: var(--spacing-md);
            font-size: 1rem;
            color: var(--primary);
        }

        .color-palette {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.active {
            border-color: white;
            box-shadow: 0 0 0 2px var(--primary);
        }

        .font-option {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 0.5rem;
            background: white;
        }

        .font-option:hover {
            background: #e8f4fc;
            border-color: var(--accent);
        }

        .font-option.active {
            border-color: var(--accent);
            background: #e8f4fc;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-md);
        }

        .export-code {
            background: #f5f5f5;
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: var(--spacing-md);
        }

        .copy-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .copy-btn:hover {
            background: #1a252f;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 900px) {
            .app-main {
                flex-direction: column;
            }
            
            .components-sidebar, .customization-panel {
                width: 100%;
                border: none;
                border-bottom: 1px solid #ddd;
            }
            
            .gallery-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .gallery-grid {
                grid-template-columns: 1fr;
            }
            
            .builder-controls {
                flex-direction: column;
            }
            
            .hero-component h2 {
                font-size: 2rem;
            }
            
            .hero-component {
                padding: var(--spacing-lg);
            }
        }

        .font-inter {
            font-family: 'Inter', sans-serif;
        }
        
        .font-roboto {
            font-family: 'Roboto', sans-serif;
        }
        
        .font-open-sans {
            font-family: 'Open Sans', sans-serif;
        }
        
        .font-montserrat {
            font-family: 'Montserrat', sans-serif;
        }

        .preview-mode .component-controls {
            display: none;
        }
    </style>
</head>
<body class="font-inter">
    <div class="app-container">
        <header class="app-header">
            <h1><i class="fas fa-palette"></i> Portfolio Builder</h1>
            <p>Click on components to add them to your portfolio. Customize colors and fonts to match your style.</p>
        </header>

        <main class="app-main">
            <div class="components-sidebar">
                <h2><i class="fas fa-puzzle-piece"></i> Components</h2>
                <div class="component-item" data-type="hero">
                    <i class="fas fa-star"></i>
                    <h3>Hero Section</h3>
                    <p>Introduction with your name and tagline</p>
                </div>
                <div class="component-item" data-type="gallery">
                    <i class="fas fa-th"></i>
                    <h3>Project Gallery</h3>
                    <p>Showcase your work with images</p>
                </div>
                <div class="component-item" data-type="about">
                    <i class="fas fa-user"></i>
                    <h3>About Section</h3>
                    <p>Tell your story and skills</p>
                </div>
                <div class="component-item" data-type="contact">
                    <i class="fas fa-envelope"></i>
                    <h3>Contact Section</h3>
                    <p>Let people get in touch with you</p>
                </div>
            </div>

            <div class="builder-area">
                <div class="builder-header">
                    <h2>Your Portfolio Preview</h2>
                    <div class="builder-controls">
                        <button class="control-btn btn-secondary" id="preview-btn">
                            <i class="fas fa-eye"></i> Preview
                        </button>
                        <button class="control-btn btn-primary" id="export-btn">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                </div>

                <div class="components-container empty">
                    <div class="empty-builder-message">
                        <i class="fas fa-arrow-left"></i>
                        <h3>Your portfolio is empty</h3>
                        <p>Click on components to the left to add them to your portfolio</p>
                    </div>
                </div>
            </div>

            <div class="customization-panel">
                <h2><i class="fas fa-sliders-h"></i> Customize</h2>
                
                <div class="panel-section">
                    <h3>Color Scheme</h3>
                    <div class="color-palette">
                        <div class="color-option active" style="background-color: #2c3e50;" data-color="#2c3e50"></div>
                        <div class="color-option" style="background-color: #3498db;" data-color="#3498db"></div>
                        <div class="color-option" style="background-color: #e74c3c;" data-color="#e74c3c"></div>
                        <div class="color-option" style="background-color: #2ecc71;" data-color="#2ecc71"></div>
                        <div class="color-option" style="background-color: #9b59b6;" data-color="#9b59b6"></div>
                        <div class="color-option" style="background-color: #f39c12;" data-color="#f39c12"></div>
                    </div>
                </div>
                
                <div class="panel-section">
                    <h3>Font Family</h3>
                    <div class="font-option active" data-font="inter">Inter</div>
                    <div class="font-option" data-font="roboto">Roboto</div>
                    <div class="font-option" data-font="open-sans">Open Sans</div>
                    <div class="font-option" data-font="montserrat">Montserrat</div>
                </div>
                
                <div class="panel-section">
                    <h3>Actions</h3>
                    <button class="control-btn btn-primary" style="width: 100%;" id="save-btn">
                        <i class="fas fa-save"></i> Save Portfolio
                    </button>
                    <button class="control-btn btn-secondary" style="width: 100%; margin-top: 0.5rem;" id="reset-btn">
                        <i class="fas fa-trash"></i> Reset All
                    </button>
                </div>
            </div>
        </main>
    </div>

    <div class="modal" id="edit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Component</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div id="edit-form"></div>
        </div>
    </div>

    <div class="modal" id="export-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Export Your Portfolio</h3>
                <button class="close-modal">&times;</button>
            </div>
            <p>Your portfolio code is ready! Copy the HTML below and save it to an HTML file.</p>
            <div class="export-code" id="export-code"></div>
            <div class="modal-actions">
                <button class="copy-btn" id="copy-code">
                    <i class="fas fa-copy"></i> Copy Code
                </button>
                <button class="control-btn btn-primary" id="test-export">
                    <i class="fas fa-eye"></i> Test Export
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let components = [];
            let currentEditingComponent = null;
            let currentColor = '#2c3e50';
            let previewMode = false;
            
            const componentsContainer = document.querySelector('.components-container');
            const componentItems = document.querySelectorAll('.component-item');
            const colorOptions = document.querySelectorAll('.color-option');
            const fontOptions = document.querySelectorAll('.font-option');
            const editModal = document.getElementById('edit-modal');
            const exportModal = document.getElementById('export-modal');
            const editForm = document.getElementById('edit-form');
            const exportCode = document.getElementById('export-code');
            
            initApp();
            
            document.getElementById('export-btn').addEventListener('click', showExportModal);
            document.getElementById('preview-btn').addEventListener('click', togglePreviewMode);
            document.getElementById('save-btn').addEventListener('click', savePortfolio);
            document.getElementById('reset-btn').addEventListener('click', resetPortfolio);
            document.getElementById('copy-code').addEventListener('click', copyCodeToClipboard);
            document.getElementById('test-export').addEventListener('click', testExport);
            
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    editModal.style.display = 'none';
                    exportModal.style.display = 'none';
                });
            });
            
            window.addEventListener('click', function(e) {
                if (e.target === editModal || e.target === exportModal) {
                    editModal.style.display = 'none';
                    exportModal.style.display = 'none';
                }
            });
            
            colorOptions.forEach(option => {
                option.addEventListener('click', function() {
                    colorOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    
                    currentColor = this.getAttribute('data-color');
                    document.documentElement.style.setProperty('--primary', currentColor);
                    document.documentElement.style.setProperty('--header-bg', currentColor); // Update header background
                    updateButtonColors();
                });
            });
            
            function updateButtonColors() {
                document.querySelectorAll('.btn-primary, .control-btn-sm').forEach(btn => {
                    btn.style.backgroundColor = currentColor;
                });
            }
            
            fontOptions.forEach(option => {
                option.addEventListener('click', function() {
                    fontOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.body.classList.remove('font-inter', 'font-roboto', 'font-open-sans', 'font-montserrat');
                    document.body.classList.add('font-' + this.getAttribute('data-font'));
                });
            });
            
            function initApp() {
                componentItems.forEach(item => {
                    item.addEventListener('click', function() {
                        const type = this.getAttribute('data-type');
                        addComponent(type);
                    });
                });
                
                loadPortfolio();
                updateButtonColors();
            }
            
            function addComponent(type) {
                const id = 'component-' + Date.now();
                const component = {
                    id: id,
                    type: type,
                    data: getDefaultDataForType(type)
                };
                
                components.push(component);
                renderComponent(component);
                updateEmptyState();
            }
            
            function getDefaultDataForType(type) {
                switch(type) {
                    case 'hero':
                        return {
                            title: 'Your Name',
                            subtitle: 'Creative Designer & Developer',
                            buttonText: 'View My Work',
                            buttonLink: 'https://www.google.com' // Fixed: Changed from '#work' to Google
                        };
                    case 'gallery':
                        return {
                            title: 'Project Gallery',
                            items: [
                                {
                                    image: 'https://images.unsplash.com/photo-1555099962-4199c345e5dd?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
                                    title: 'Project 1'
                                },
                                {
                                    image: 'https://images.unsplash.com/photo-1551650975-87deedd944c3?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
                                    title: 'Project 2'
                                },
                                {
                                    image: 'https://images.unsplash.com/photo-1550439062-609e1531270e?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
                                    title: 'Project 3'
                                }
                            ]
                        };
                    case 'about':
                        return {
                            title: 'About Me',
                            content: "I'm a passionate creator focused on building beautiful, functional experiences that make a difference.\n\nWith expertise in design and development, I bring ideas to life through careful craft and attention to detail."
                        };
                    case 'contact':
                        return {
                            title: 'Get In Touch',
                            email: 'your.email@example.com',
                            phone: '(123) 456-7890'
                        };
                    default:
                        return {};
                }
            }
            
            function renderComponent(component) {
                const element = document.createElement('div');
                element.className = 'portfolio-component';
                element.id = component.id;
                
                let html = '';
                switch(component.type) {
                    case 'hero':
                        html = `
                            <div class="hero-component">
                                <h2>${component.data.title}</h2>
                                <p>${component.data.subtitle}</p>
                                <a href="${component.data.buttonLink}" class="control-btn btn-primary" target="_blank">${component.data.buttonText}</a>
                            </div>
                        `;
                        break;
                    case 'gallery':
                        html = `
                            <div class="gallery-component">
                                <h3>${component.data.title}</h3>
                                <div class="gallery-grid">
                                    ${component.data.items.map(item => `
                                        <div class="gallery-item">
                                            <img src="${item.image}" alt="${item.title}">
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                        break;
                    case 'about':
                        html = `
                            <div class="about-component">
                                <h3>${component.data.title}</h3>
                                <p>${component.data.content.replace(/\n/g, '<br>')}</p>
                            </div>
                        `;
                        break;
                    case 'contact':
                        html = `
                            <div class="contact-component">
                                <h3>${component.data.title}</h3>
                                <div class="contact-details">
                                    <div class="contact-detail">
                                        <i class="fas fa-envelope"></i>
                                        <span>${component.data.email}</span>
                                    </div>
                                    <div class="contact-detail">
                                        <i class="fas fa-phone"></i>
                                        <span>${component.data.phone}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                        break;
                }
                
                html += `
                    <div class="component-controls">
                        <button class="control-btn-sm edit-btn"><i class="fas fa-edit"></i></button>
                        <button class="control-btn-sm delete-btn"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                
                element.innerHTML = html;
                componentsContainer.appendChild(element);
                
                element.querySelectorAll('.btn-primary, .control-btn-sm').forEach(btn => {
                    btn.style.backgroundColor = currentColor;
                });
                
                element.querySelector('.delete-btn').addEventListener('click', function() {
                    deleteComponent(component.id);
                });
                
                element.querySelector('.edit-btn').addEventListener('click', function() {
                    openEditModal(component);
                });
            }
            
            function openEditModal(component) {
                currentEditingComponent = component;
                
                let formHTML = '';
                switch(component.type) {
                    case 'hero':
                        formHTML = `
                            <div class="form-group">
                                <label for="edit-title">Title</label>
                                <input type="text" id="edit-title" value="${component.data.title}">
                            </div>
                            <div class="form-group">
                                <label for="edit-subtitle">Subtitle</label>
                                <input type="text" id="edit-subtitle" value="${component.data.subtitle}">
                            </div>
                            <div class="form-group">
                                <label for="edit-buttonText">Button Text</label>
                                <input type="text" id="edit-buttonText" value="${component.data.buttonText}">
                            </div>
                            <div class="form-group">
                                <label for="edit-buttonLink">Button Link</label>
                                <input type="text" id="edit-buttonLink" value="${component.data.buttonLink}" placeholder="https://www.google.com">
                            </div>
                            <div class="modal-actions">
                                <button class="control-btn btn-primary" id="save-edit">Save Changes</button>
                            </div>
                        `;
                        break;
                    case 'gallery':
                        formHTML = `
                            <div class="form-group">
                                <label for="edit-title">Gallery Title</label>
                                <input type="text" id="edit-title" value="${component.data.title}">
                            </div>
                            <h4>Gallery Items</h4>
                            ${component.data.items.map((item, index) => `
                                <div class="form-group">
                                    <label>Item ${index + 1} Image URL</label>
                                    <input type="text" value="${item.image}" data-index="${index}" data-field="image">
                                </div>
                                <div class="form-group">
                                    <label>Item ${index + 1} Title</label>
                                    <input type="text" value="${item.title}" data-index="${index}" data-field="title">
                                </div>
                            `).join('')}
                            <div class="modal-actions">
                                <button class="control-btn btn-primary" id="save-edit">Save Changes</button>
                            </div>
                        `;
                        break;
                    case 'about':
                        formHTML = `
                            <div class="form-group">
                                <label for="edit-title">Title</label>
                                <input type="text" id="edit-title" value="${component.data.title}">
                            </div>
                            <div class="form-group">
                                <label for="edit-content">Content</label>
                                <textarea id="edit-content">${component.data.content}</textarea>
                            </div>
                            <div class="modal-actions">
                                <button class="control-btn btn-primary" id="save-edit">Save Changes</button>
                            </div>
                        `;
                        break;
                    case 'contact':
                        formHTML = `
                            <div class="form-group">
                                <label for="edit-title">Title</label>
                                <input type="text" id="edit-title" value="${component.data.title}">
                            </div>
                            <div class="form-group">
                                <label for="edit-email">Email</label>
                                <input type="text" id="edit-email" value="${component.data.email}">
                            </div>
                            <div class="form-group">
                                <label for="edit-phone">Phone</label>
                                <input type="text" id="edit-phone" value="${component.data.phone}">
                            </div>
                            <div class="modal-actions">
                                <button class="control-btn btn-primary" id="save-edit">Save Changes</button>
                            </div>
                        `;
                        break;
                }
                
                editForm.innerHTML = formHTML;
                editModal.style.display = 'flex';
                
                document.getElementById('save-edit').addEventListener('click', function() {
                    saveEditedComponent(component);
                });
            }
            
            function saveEditedComponent(component) {
                switch(component.type) {
                    case 'hero':
                        component.data.title = document.getElementById('edit-title').value;
                        component.data.subtitle = document.getElementById('edit-subtitle').value;
                        component.data.buttonText = document.getElementById('edit-buttonText').value;
                        component.data.buttonLink = document.getElementById('edit-buttonLink').value;
                        break;
                    case 'gallery':
                        component.data.title = document.getElementById('edit-title').value;
                        document.querySelectorAll('#edit-form input').forEach(input => {
                            if (input.id !== 'edit-title') {
                                const index = parseInt(input.getAttribute('data-index'));
                                const field = input.getAttribute('data-field');
                                component.data.items[index][field] = input.value;
                            }
                        });
                        break;
                    case 'about':
                        component.data.title = document.getElementById('edit-title').value;
                        component.data.content = document.getElementById('edit-content').value;
                        break;
                    case 'contact':
                        component.data.title = document.getElementById('edit-title').value;
                        component.data.email = document.getElementById('edit-email').value;
                        component.data.phone = document.getElementById('edit-phone').value;
                        break;
                }
                
                document.getElementById(component.id).remove();
                renderComponent(component);
                editModal.style.display = 'none';
                savePortfolio();
            }
            
            function deleteComponent(id) {
                components = components.filter(component => component.id !== id);
                document.getElementById(id).remove();
                updateEmptyState();
                savePortfolio();
            }
            
            function updateEmptyState() {
                if (components.length === 0) {
                    componentsContainer.classList.add('empty');
                } else {
                    componentsContainer.classList.remove('empty');
                }
            }
            
            function togglePreviewMode() {
                previewMode = !previewMode;
                document.querySelector('.app-container').classList.toggle('preview-mode', previewMode);
                
                const previewBtn = document.getElementById('preview-btn');
                if (previewMode) {
                    previewBtn.innerHTML = '<i class="fas fa-edit"></i> Edit';
                } else {
                    previewBtn.innerHTML = '<i class="fas fa-eye"></i> Preview';
                }
            }
            
            function savePortfolio() {
                const portfolioData = {
                    components: components,
                    color: currentColor,
                    font: document.querySelector('.font-option.active').getAttribute('data-font')
                };
                
                localStorage.setItem('portfolioData', JSON.stringify(portfolioData));
                
                // Show a brief confirmation
                const saveBtn = document.getElementById('save-btn');
                const originalText = saveBtn.innerHTML;
                saveBtn.innerHTML = '<i class="fas fa-check"></i> Saved!';
                
                setTimeout(() => {
                    saveBtn.innerHTML = originalText;
                }, 2000);
            }
            
            function loadPortfolio() {
                const savedData = localStorage.getItem('portfolioData');
                if (savedData) {
                    const portfolioData = JSON.parse(savedData);
                    components = portfolioData.components || [];
                    currentColor = portfolioData.color || '#2c3e50';
                    
                    // Apply saved color
                    document.documentElement.style.setProperty('--primary', currentColor);
                    document.documentElement.style.setProperty('--header-bg', currentColor);
                    colorOptions.forEach(option => {
                        if (option.getAttribute('data-color') === currentColor) {
                            option.classList.add('active');
                        } else {
                            option.classList.remove('active');
                        }
                    });
                    
                    // Apply saved font
                    const savedFont = portfolioData.font || 'inter';
                    document.body.classList.remove('font-inter', 'font-roboto', 'font-open-sans', 'font-montserrat');
                    document.body.classList.add('font-' + savedFont);
                    fontOptions.forEach(option => {
                        if (option.getAttribute('data-font') === savedFont) {
                            option.classList.add('active');
                        } else {
                            option.classList.remove('active');
                        }
                    });
                    
                    // Fix old hero components with the wrong link
                    components.forEach(component => {
                        if (component.type === 'hero' && component.data.buttonLink === '#work') {
                            component.data.buttonLink = 'https://www.google.com';
                        }
                    });
                    
                    // Render components
                    components.forEach(component => {
                        renderComponent(component);
                    });
                    
                    updateEmptyState();
                    updateButtonColors();
                }
            }
            
            function resetPortfolio() {
                if (confirm('Are you sure you want to reset your portfolio? This cannot be undone.')) {
                    components = [];
                    componentsContainer.innerHTML = '';
                    updateEmptyState();
                    localStorage.removeItem('portfolioData');
                    
                    // Reset to defaults
                    currentColor = '#2c3e50';
                    document.documentElement.style.setProperty('--primary', currentColor);
                    document.documentElement.style.setProperty('--header-bg', currentColor);
                    colorOptions.forEach(option => {
                        if (option.getAttribute('data-color') === currentColor) {
                            option.classList.add('active');
                        } else {
                            option.classList.remove('active');
                        }
                    });
                    
                    document.body.classList.remove('font-inter', 'font-roboto', 'font-open-sans', 'font-montserrat');
                    document.body.classList.add('font-inter');
                    fontOptions.forEach(option => {
                        if (option.getAttribute('data-font') === 'inter') {
                            option.classList.add('active');
                        } else {
                            option.classList.remove('active');
                        }
                    });
                    
                    updateButtonColors();
                }
            }
            
            function showExportModal() {
                exportModal.style.display = 'flex';
                
                // Generate the HTML code for export
                let htmlCode = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Portfolio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Montserrat:wght@400;500;600&family=Open+Sans:wght@400;500;600&family=Roboto:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: ${currentColor};
            --secondary: #ecf0f1;
            --accent: #3498db;
            --text: #333;
            --light-text: #777;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 2rem;
            --spacing-xl: 4rem;
            --border-radius: 8px;
            --transition: all 0.3s ease;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: '${document.querySelector('.font-option.active').textContent}', sans-serif;
            color: var(--text);
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            line-height: 1.6;
            min-height: 100vh;
            padding: var(--spacing-md);
        }

        .portfolio-header {
            text-align: center;
            padding: var(--spacing-lg);
            background: var(--primary);
            color: white;
            margin-bottom: var(--spacing-lg);
            border-radius: var(--border-radius);
        }

        .portfolio-header h1 {
            margin-bottom: var(--spacing-sm);
        }

        .portfolio-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .hero-component {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: var(--spacing-xl);
            text-align: center;
            border-radius: var(--border-radius);
        }

        .hero-component h2 {
            font-size: 2.5rem;
            margin-bottom: var(--spacing-md);
            color: var(--primary);
        }

        .hero-component p {
            font-size: 1.2rem;
            color: var(--light-text);
            margin-bottom: var(--spacing-lg);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            padding: 0.6rem 1rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            transition: var(--transition);
            text-decoration: none;
        }

        .btn-primary:hover {
            background: #1a252f;
        }

        .gallery-component {
            padding: var(--spacing-lg);
        }

        .gallery-component h3 {
            margin-bottom: var(--spacing-md);
            color: var(--primary);
            text-align: center;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-md);
        }

        .gallery-item {
            position: relative;
            border-radius: var(--border-radius);
            overflow: hidden;
            height: 150px;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .gallery-item:hover img {
            transform: scale(1.05);
        }

        .about-component {
            padding: var(--spacing-lg);
        }

        .about-component h3 {
            margin-bottom: var(--spacing-md);
            color: var(--primary);
            text-align: center;
        }

        .about-component p {
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
        }

        .contact-component {
            padding: var(--spacing-lg);
        }

        .contact-component h3 {
            margin-bottom: var(--spacing-md);
            color: var(--primary);
            text-align: center;
        }

        .contact-details {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            align-items: center;
        }

        .contact-detail {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .contact-detail i {
            color: var(--accent);
            width: 20px;
        }

        @media (max-width: 900px) {
            .gallery-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .gallery-grid {
                grid-template-columns: 1fr;
            }
            
            .hero-component h2 {
                font-size: 2rem;
            }
            
            .hero-component {
                padding: var(--spacing-lg);
            }
        }
    </style>
</head>
<body>
    <div class="portfolio-header">
        <h1>My Portfolio</h1>
        <p>A showcase of my work and skills</p>
    </div>
    
    <div class="portfolio-container">`;

                // Add each component to the exported code
                components.forEach(component => {
                    switch(component.type) {
                        case 'hero':
                            htmlCode += `
        <div class="hero-component">
            <h2>${component.data.title}</h2>
            <p>${component.data.subtitle}</p>
            <a href="${component.data.buttonLink}" class="btn-primary" target="_blank">${component.data.buttonText}</a>
        </div>`;
                            break;
                        case 'gallery':
                            htmlCode += `
        <div class="gallery-component">
            <h3>${component.data.title}</h3>
            <div class="gallery-grid">
                ${component.data.items.map(item => `
                <div class="gallery-item">
                    <img src="${item.image}" alt="${item.title}">
                </div>`).join('')}
            </div>
        </div>`;
                            break;
                        case 'about':
                            htmlCode += `
        <div class="about-component">
            <h3>${component.data.title}</h3>
            <p>${component.data.content.replace(/\n/g, '<br>')}</p>
        </div>`;
                            break;
                        case 'contact':
                            htmlCode += `
        <div class="contact-component">
            <h3>${component.data.title}</h3>
            <div class="contact-details">
                <div class="contact-detail">
                    <i class="fas fa-envelope"></i>
                    <span>${component.data.email}</span>
                </div>
                <div class="contact-detail">
                    <i class="fas fa-phone"></i>
                    <span>${component.data.phone}</span>
                </div>
            </div>
        </div>`;
                            break;
                    }
                });

                htmlCode += `
    </div>
</body>
</html>`;

                exportCode.textContent = htmlCode;
            }
            
            function copyCodeToClipboard() {
                const textarea = document.createElement('textarea');
                textarea.value = exportCode.textContent;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                
                const copyBtn = document.getElementById('copy-code');
                copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                
                setTimeout(() => {
                    copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copy Code';
                }, 2000);
            }
            
            function testExport() {
                const htmlCode = exportCode.textContent;
                const blob = new Blob([htmlCode], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                window.open(url, '_blank');
            }
        });
    </script>
</body>
</html>
